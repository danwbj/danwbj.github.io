---
title: 理解VirtualDOM
date: 2018-09-01 10:30:48
tags: [Virtual DOM]
category: [javascript]
---

#### 数据变更与 UI 同步发展历史

- 早期，页面是静态的，数据发生变化就需要刷新页面来更新页面
- 刷新页面性能受到影响，并且用户体验不好，因此出现只更新变化数据对应的页面，使用 js 操作 dom 来实现
- 开发通过操作 dom 实现部分页面更新很麻烦，因此一些框架诞生，借助框架，监听数据变更，变更后更新对应的 dom 节点，开发者编码减少
- MVVM 框架出现了，以 AngularJS 为代表
- React 出现，他不是 MVVM 框架，它的实现思路：回到最初的方案，如果数据变化就重新执行一次整体的渲染，不用去管数据的那部分发生了变化，但是这样体验太差，因此 react 引入了 Virtual DOM 实现了性能上的优化

#### Virtual DOM

在数据与真实的 dom 之前建立一层缓冲，数据变化了就调用 react 的渲染方法，react 并不是直接得到新的 dom 然后替换，而是先生成 Virtual DOM 然后在与上一次渲染得到的 Virtual DOM 进行对比，得到差异的地方，再把差异的地方更新到真实的 dom

![avatar](/images/v-dom.jpeg)

#### Virtual Dom 算法的实现

- 通过 JS 来模拟创建 DOM 对象
- 判断两个对象的差异(diff)
- 渲染差异(patch)

#### diff 算法

从左到右从上到下遍历 dom 树，每个节点都有一个唯一的 key
两个节点对比：

- 新的节点的 tagname 或者 key 和旧的不同，则直接替换节点，不需要遍历旧节点的子元素
- 新的节点的  tagName  和  key（可能都没有）和旧的相同，开始遍历子树
- 没有新的节点，那么什么都不用做
