---
title: CentOS7安装配置使用Postgresql
date: 2018-06-20 20:20:42
tags: [postgresql,linux]
category: [数据库]
---
### 安装配置
执行安装命令

``` 
# yum install postgresql-server

# yum install postgresql-contrib
```
启动postgresql服务   
初次启动会报错，是因为没有初始化数据库

``` 
# systemctl start postgresql
Job for postgresql.service failed because the control process exited with error code. See "systemctl status postgresql.service" and "journalctl -xe" for details.
```
初始化数据库

```
# postgresql-setup initdb
```
再次启动postgresql服务

```
# systemctl start postgresql
```
查看postgresql状态

```
# systemctl status postgresql
● postgresql.service - PostgreSQL database server
   Loaded: loaded (/usr/lib/systemd/system/postgresql.service; disabled; vendor preset: disabled)
   Active: active (running) since Wed 2018-06-20 16:38:12 CST; 3h 57min ago
  Process: 15941 ExecStop=/usr/bin/pg_ctl stop -D ${PGDATA} -s -m fast (code=exited, status=0/SUCCESS)
  Process: 15948 ExecStart=/usr/bin/pg_ctl start -D ${PGDATA} -s -o -p ${PGPORT} -w -t 300 (code=exited, status=0/SUCCESS)
  Process: 15942 ExecStartPre=/usr/bin/postgresql-check-db-dir ${PGDATA} (code=exited, status=0/SUCCESS)
 Main PID: 15952 (postgres)
   CGroup: /system.slice/postgresql.service
           ├─15952 /usr/bin/postgres -D /var/lib/pgsql/data -p 5432
           ├─15953 postgres: logger process
           ├─15955 postgres: checkpointer process
           ├─15956 postgres: writer process
           ├─15957 postgres: wal writer process
           ├─15958 postgres: autovacuum launcher process
           └─15959 postgres: stats collector process

Jun 20 16:38:11 JD systemd[1]: Starting PostgreSQL database server...
Jun 20 16:38:12 JD systemd[1]: Started PostgreSQL database server.
```
设置开机自启动

```
# systemctl enable postgresql
```
su – postgres切换到postgresql用户执行psql的操作

```
# su - postgres
Last login: Wed Jun 20 16:36:25 CST 2018 on pts/0
Last failed login: Wed Jun 20 20:39:12 CST 2018 from server2.4puntozero.it on ssh:notty
There were 4 failed login attempts since the last successful login.
-bash-4.2$ psql
psql (9.2.23)
Type "help" for help.

postgres=#
```
查看所有数据库

```
postgres=# \l
                                 List of databases
   Name    |   Owner   | Encoding  |   Collate   | Ctype |    Access privileges
-----------+-----------+-----------+-------------+-------+-------------------------
 postgres  | postgres  | SQL_ASCII | en_US.UTF-8 | C     |
 template0 | postgres  | SQL_ASCII | en_US.UTF-8 | C     | =c/postgres            +
           |           |           |             |       | postgres=CTc/postgres
 template1 | postgres  | SQL_ASCII | en_US.UTF-8 | C     | =c/postgres            +
           |           |           |             |       | postgres=CTc/postgres
(4 rows)

```
创建用户

```
postgres=# CREATE USER username WITH PASSWORD 'password';
CREATE ROLE
```
为用户创建数据库

```
postgres=# CREATE DATABASE dbname OWNER username;
CREATE DATABASE
```
给用户所有操作创建的数据库的权限

```
postgres=# GRANT ALL PRIVILEGES ON DATABASE dbname to username;
GRANT
```

到此postgresql安装成功！

### 配置远程连接
如果想要在客户端工具（像pgAdmin）中连接postgres，需要设置postgres远程连接   
修改data目录下的pg_hba.conf和postgresql.conf

```
# vi postgresql.conf

修改 listen_addresses='localhost'
为
listen_addresses='*'

```

```
# vi pg_hba.conf

在底部增加以下配置
host    all    all    0.0.0.0/0    md5

```
如果不希望允许所有IP远程访问，则可以将上述配置项中的0.0.0.0设定为特定的IP值。






